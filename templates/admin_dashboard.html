{% extends "base.html" %}

{% block title %}Dashboard Admin - HyperLiquid SaaS{% endblock %}

{% block content %}
<div class="card">
    <div class="header">
        <div class="logo">üë®‚Äçüíº Dashboard Admin</div>
        <div class="subtitle">Gestion des utilisateurs et bots</div>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
        <div style="background: #f0fff4; padding: 20px; border-radius: 10px; text-align: center;">
            <div style="font-size: 2em; color: #22543d;">{{ users|selectattr('is_active')|list|length }}</div>
            <div style="color: #22543d; font-weight: 600;">Utilisateurs Actifs</div>
        </div>
        
        <div style="background: #fef5e7; padding: 20px; border-radius: 10px; text-align: center;">
            <div style="font-size: 2em; color: #744210;">{{ users|rejectattr('is_active')|list|length }}</div>
            <div style="color: #744210; font-weight: 600;">En Attente</div>
        </div>
        
        <div style="background: #e6fffa; padding: 20px; border-radius: 10px; text-align: center;">
            <div style="font-size: 2em; color: #234e52;">{{ users|list|length }}</div>
            <div style="color: #234e52; font-weight: 600;">Total Inscrits</div>
        </div>
    </div>
    
    <h2 style="margin: 40px 0 20px 0; color: #2d3748;">Gestion des Utilisateurs</h2>
    
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <thead style="background: #f7fafc;">
                <tr>
                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #e2e8f0;">Nom</th>
                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #e2e8f0;">Email</th>
                    <th style="padding: 15px; text-align: left; border-bottom: 1px solid #e2e8f0;">Wallet</th>
                    <th style="padding: 15px; text-align: center; border-bottom: 1px solid #e2e8f0;">Statut</th>
                    <th style="padding: 15px; text-align: center; border-bottom: 1px solid #e2e8f0;">Inscription</th>
                    <th style="padding: 15px; text-align: center; border-bottom: 1px solid #e2e8f0;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr style="border-bottom: 1px solid #f1f5f9;">
                    <td style="padding: 15px;">{{ user.name }}</td>
                    <td style="padding: 15px; color: #718096;">{{ user.email }}</td>
                    <td style="padding: 15px; font-family: monospace; font-size: 0.9em;">{{ user.wallet_address[:10] }}...</td>
                    <td style="padding: 15px; text-align: center;">
                        {% if user.is_active %}
                        <span style="background: #c6f6d5; color: #22543d; padding: 5px 10px; border-radius: 20px; font-size: 0.9em; font-weight: 600;">‚úÖ Actif</span>
                        {% else %}
                        <span style="background: #fed7d7; color: #742a2a; padding: 5px 10px; border-radius: 20px; font-size: 0.9em; font-weight: 600;">‚è≥ En attente</span>
                        {% endif %}
                    </td>
                    <td style="padding: 15px; text-align: center; color: #718096; font-size: 0.9em;">{{ user.created_at.strftime('%d/%m/%Y') }}</td>
                    <td style="padding: 15px; text-align: center;">
                        {% if user.is_active %}
                        <button onclick="deactivateUser({{ user.id }})" style="background: #fc8181; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.9em;">
                            üî¥ D√©sactiver
                        </button>
                        {% else %}
                        <button onclick="activateUser({{ user.id }})" style="background: #68d391; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.9em;">
                            ‚úÖ Activer
                        </button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    {% if not users %}
    <div style="text-align: center; padding: 60px 0; color: #718096;">
        <div style="font-size: 3em; margin-bottom: 20px;">üì≠</div>
        <h3>Aucun utilisateur inscrit</h3>
        <p>Les nouvelles inscriptions appara√Ætront ici.</p>
    </div>
    {% endif %}
</div>

<script>
async function activateUser(userId) {
    if (!confirm('√ätes-vous s√ªr de vouloir activer cet utilisateur ?')) return;
    
    try {
        const response = await fetch(`/admin/activate/${userId}`, {
            method: 'POST',
        });
        
        if (response.ok) {
            alert('‚úÖ Utilisateur activ√© avec succ√®s !');
            location.reload();
        } else {
            alert('‚ùå Erreur lors de l\'activation');
        }
    } catch (error) {
        alert('‚ùå Erreur de connexion');
    }
}

async function deactivateUser(userId) {
    if (!confirm('√ätes-vous s√ªr de vouloir d√©sactiver cet utilisateur ?')) return;
    
    try {
        const response = await fetch(`/admin/deactivate/${userId}`, {
            method: 'POST',
        });
        
        if (response.ok) {
            alert('üî¥ Utilisateur d√©sactiv√© avec succ√®s !');
            location.reload();
        } else {
            alert('‚ùå Erreur lors de la d√©sactivation');
        }
    } catch (error) {
        alert('‚ùå Erreur de connexion');
    }
}
</script>
{% endblock %}